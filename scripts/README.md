# Rotated Ellipse Intersection

- ellipse parameters: $a$, $b$, $c_x$, $c_y$, $\theta$
- ray parameters: $p_x$, $p_y$, $v_x$, $v_y$
- $t_0 = a^2\sin^2\theta+b^2\cos^2\theta$
- $t_1 = a^2\cos^2\theta+b^2\sin^2\theta$
- $t_2 = (a^2 - b^2)\sin\theta\cos\theta$
- $t_3 = c_y t_2 - c_x t_0$
- $t_4 = c_x t_2 - c_y t_1$
- $t_5 = c_x^2 t_0 + c_y^2 t_1 - 2 c_x c_y t_2$

- Intersection

|           | $v_x^2$       | $v_x v_y$          | $v_y^2$       | $v_x$ | $v_y$ | $1$ |
|-----------|---------------|--------------------|---------------|-------|-------|-----|
| $p_x^2$   |               |                    | $-1$          |       |       |     |
| $p_x p_y$ |               | $2$                |               |       |       |     |
| $p_y^2$   | $-1$          |                    |               |       |       |     |
| $p_x$     |               | $-2c_y$            | $2c_x$        |       |       |     |
| $p_y$     | $2c_y$        | $-2c_x$            |               |       |       |     |
| $1$       | $t_0 - c_y^2$ | $-2t_2 + 2c_x c_y$ | $t_1 - c_x^2$ |       |       |     |

- Sign

|           | $v_x^2$ | $v_x v_y$ | $v_y^2$ | $v_x$ | $v_y$ | $1$                    |
|-----------|---------|-----------|---------|-------|-------|------------------------|
| $p_x^2$   |         |           |         |       |       | $\frac{t_0}{a^2b^2}$   |
| $p_x p_y$ |         |           |         |       |       | $\frac{-2t_2}{a^2b^2}$ |
| $p_y^2$   |         |           |         |       |       | $\frac{t_1}{a^2b^2}$   |
| $p_x$     |         |           |         |       |       | $\frac{2t_3}{a^2b^2}$  |
| $p_y$     |         |           |         |       |       | $\frac{2t_4}{a^2b^2}$  |
| $1$       |         |           |         |       |       | $\frac{t_5}{a^2b^2}-1$ |

- tmp0

|           | $v_x^2$ | $v_x v_y$ | $v_y^2$ | $v_x$ | $v_y$ | $1$ |
|-----------|---------|-----------|---------|-------|-------|-----|
| $p_x^2$   |         |           |         |       |       |     |
| $p_x p_y$ |         |           |         |       |       |     |
| $p_y^2$   |         |           |         |       |       |     |
| $p_x$     |         |           |         |       |       |     |
| $p_y$     |         |           |         |       |       |     |
| $1$       | $t_0$   | $-2t_2$   | $t_1$   |       |       |     |

- tmp2

|           | $v_x^2$ | $v_x v_y$ | $v_y^2$ | $v_x$                | $v_y$                | $1$ |
|-----------|---------|-----------|---------|----------------------|----------------------|-----|
| $p_x^2$   |         |           |         |                      |                      |     |
| $p_x p_y$ |         |           |         |                      |                      |     |
| $p_y^2$   |         |           |         |                      |                      |     |
| $p_x$     |         |           |         | $t_0$                | $-t_2$               |     |
| $p_y$     |         |           |         | $-t_2$               | $t_1$                |     |
| $1$       |         |           |         | $-c_x t_0 + c_y t_2$ | $-c_y t_1 + c_x t_2$ |     |

# Rotated Ellipsoid Intersection

- ellipsoid parameters: $a$, $b$, $c$, $c_x$, $c_y$, $c_z$, $\theta$, $\phi$
- ray parameters: $p_x$, $p_y$, $p_z$, $v_x$, $v_y$, $v_z$
- $t_{-1} = a^2 + b^2$
- $t_0 = a^2 - b^2$
- $t_1 = a^2\cos^2\theta+b^2\sin^2\theta$
- $t_2 = a^2\sin^2\theta+b^2\cos^2\theta$
- $t_3 = t_1 - c^2$
- $t_4 = t_2 - c^2$
- $t_5 = t_1 \sin^2\phi + c^2 \cos^2\phi = (a^2\cos^2\phi + b^2\sin^2\theta)\sin^2\phi + c^2\cos^2\phi$
- $t_6 = t_1 \cos^2\phi + c^2 \sin^2\phi = (a^2\cos^2\phi + b^2\sin^2\theta)\cos^2\phi + c^2\sin^2\phi$
- $t_7$
- $t_8$
- $t_9 = \sin\phi\sin(2\theta)$
- $t_{10} = \cos\phi\sin(2\theta)$
- $t_{11} = \sin\phi\cos(2\theta)$
- $t_{12} = \cos\phi\cos(2\theta)$
- $t_{13} = t_3\sin(2\phi)$
- $t_{14} = a^2b^2\sin^2\phi+c^2t_2\cos^2\phi-c_y^2t_5+c_yc_zt_0t_9-c_z^2t_2$
- $t_{15} = c^2t_0t_{10}+2c_xc_yt_5-c_xc_zt_0t_9+c_yc_zt_{13}-c_z^2t_0t_{10}$
- $t_{16} = a^2b^2\sin(2\phi)-c^2t_2\sin(2\phi)-c_xc_yt_0t_9+2c_xc_zt_2-c_y^2t_{13}+c_yc_zt_0t_{10}$
- $t_{17} = c^2t_1-c_x^2t_5-c_xc_zt_{13}-c_z^2t_6$
- $t_{18} = -c^2t_0t_9+c_x^2t_0t_9+c_xc_yt_{13}+c_xc_zt_0t_{10}+2c_yc_zt_6$
- $t_{19} = a^2b^2\cos^2\phi+c^2t_2\sin^2\phi-c_x^2t_2-c_xc_yt_0t_{10}-c_y^2t_6$
- Intersection

|           | $v_x^2$              | $v_x v_y$                           | $v_x v_z$                              | $v_y^2$               | $v_y v_z$                               | $v_z^2$                | $v_x$ | $v_y$ | $v_z$ | $1$ |
|-----------|----------------------|-------------------------------------|----------------------------------------|-----------------------|-----------------------------------------|------------------------|-------|-------|-------|-----|
| $p_x^2$   |                      |                                     |                                        | $-t_5$                | $t_0 t_9$                               | $-t_2$                 |       |       |       |     |
| $p_x p_y$ |                      | $2t_5$                              | $-t_0 t_9$                             |                       | $t_{13}$                                | $-t_0 t_{10}$          |       |       |       |     |
| $p_x p_z$ |                      | $-t_0 t_9$                          | $2t_2$                                 | $-t_{13}$             | $t_0 t_{11}$                            |                        |       |       |       |     |
| $p_y^2$   | $-t_5$               |                                     | $-t_{13}$                              |                       |                                         | $-t_6$                 |       |       |       |     |
| $p_y p_z$ | $t_0 t_9$            |                                     | $t_0 t_{10}$                           |                       | $2t_6$                                  |                        |       |       |       |     |
| $p_z^2$   | $-t_2$               | $-t_0 t_{10}$                       |                                        | $-t_6$                |                                         |                        |       |       |       |     |
| $p_x$     |                      | $-2c_y t_5+c_z t_0 t_9$             | $c_y t_0 t_9-2c_z t_2$                 | $2c_x t_5+c_z t_{13}$ | $-2c_xt_0t_9-c_yt_{13}-c_zt_{10}t_{-1}$ | $2c_xt_2+c_yt_0t_{10}$ |       |       |       |     |
| $p_y$     | $2c_yt_5-c_zt_0t_9$  | $-2c_xt_5-c_zt_{13}$                | $c_xt_0t_9+2t_yt_{13}-c_zt_{-1}t_{10}$ |                       | $-c_xt_{13}-2c_zt_6$                    | $c_xt_0t_{10}+2c_yt_6$ |       |       |       |     |
| $p_z$     | $-c_yt_0t_9+2c_zt_2$ | $c_xt_0t_9-c_yt_{13}+2c_zt_0t_{10}$ | $-2c_xt_2-c_yt_0t_{10}$                | $c_xt_{13}+2c_zt_6$   | $-c_xt_0t_{10}-2c_yt_6$                 |                        |       |       |       |     |
| 1         | $t_{14}$             | $t_{15}$                            | $t_{16}$                               | $t_{17}$              | $t_{18}$                                | $t_{19}$               |       |       |       |     |

- Sign

|           | $v_x^2$ | $v_x v_y$ | $v_x v_z$ | $v_y^2$ | $v_y v_z$ | $v_z^2$ | $v_x$ | $v_y$ | $v_z$ | $1$ |
|-----------|---------|-----------|-----------|---------|-----------|---------|-------|-------|-------|-----|
| $p_x^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_x p_y$ |         |           |           |         |           |         |       |       |       |     |
| $p_x p_z$ |         |           |           |         |           |         |       |       |       |     |
| $p_y^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_y p_z$ |         |           |           |         |           |         |       |       |       |     |
| $p_z^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_x$     |         |           |           |         |           |         |       |       |       |     |
| $p_y$     |         |           |           |         |           |         |       |       |       |     |
| $p_z$     |         |           |           |         |           |         |       |       |       |     |
| 1         |         |           |           |         |           |         |       |       |       |     |

- tmp0

|           | $v_x^2$ | $v_x v_y$ | $v_x v_z$ | $v_y^2$ | $v_y v_z$ | $v_z^2$ | $v_x$ | $v_y$ | $v_z$ | $1$ |
|-----------|---------|-----------|-----------|---------|-----------|---------|-------|-------|-------|-----|
| $p_x^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_x p_y$ |         |           |           |         |           |         |       |       |       |     |
| $p_x p_z$ |         |           |           |         |           |         |       |       |       |     |
| $p_y^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_y p_z$ |         |           |           |         |           |         |       |       |       |     |
| $p_z^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_x$     |         |           |           |         |           |         |       |       |       |     |
| $p_y$     |         |           |           |         |           |         |       |       |       |     |
| $p_z$     |         |           |           |         |           |         |       |       |       |     |
| 1         |         |           |           |         |           |         |       |       |       |     |

- tmp2

|           | $v_x^2$ | $v_x v_y$ | $v_x v_z$ | $v_y^2$ | $v_y v_z$ | $v_z^2$ | $v_x$ | $v_y$ | $v_z$ | $1$ |
|-----------|---------|-----------|-----------|---------|-----------|---------|-------|-------|-------|-----|
| $p_x^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_x p_y$ |         |           |           |         |           |         |       |       |       |     |
| $p_x p_z$ |         |           |           |         |           |         |       |       |       |     |
| $p_y^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_y p_z$ |         |           |           |         |           |         |       |       |       |     |
| $p_z^2$   |         |           |           |         |           |         |       |       |       |     |
| $p_x$     |         |           |           |         |           |         |       |       |       |     |
| $p_y$     |         |           |           |         |           |         |       |       |       |     |
| $p_z$     |         |           |           |         |           |         |       |       |       |     |
| 1         |         |           |           |         |           |         |       |       |       |     |
